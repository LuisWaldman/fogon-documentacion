\subsubsection{Vista de procesos}\label{sec:vista-procesos}

Aqui repasaremos, con diagramas de secuencia, como la clase reproductor utiliza
un Strategy para manejar la reproduccion en modo desconectado y en modo conectado. 

Ejemplificamos con el proceso IniciarReproduccion, pero debe suponerse 
uno similar para DetenerReproduccion,CambiarCompas, CambiarLaListaDeCanciones, etc.

Luego, mostraremos la secuencia con la que logra sincronizar relojes con el servidor y
entre clientes usando WebRTC.

\paragraph{IniciarReproduccion en modo local}

El reproductor delega en la estrategia "StrategyReproductor" desconectada, que prepara la cancion en el cliente.

\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{out/diaguml/diagrama-secuencia-iniciarcancion/diagrama-secuencia-iniciarcancionunica}
\caption{Secuencia de inicio de reproduccion en modo local}
\end{figure}

\paragraph{IniciarReproduccion en un Fogon} 

Cuando se esta en una sesion, se manda al servidor la orden de iniciar reproduccion, 
y se espera la se√±al de inicio coordinado.



\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{out/diaguml/diagrama-secuencia-iniciarcanciondistribuido/diagrama-secuencia-iniciarcanciondistribuido}
\caption{Secuencia de inicio de reproduccion distribuida: esta vez, la estrategia incluye al servidor y luego se inicia coordinadamente.}
\end{figure}


\paragraph{Sincronizar relojes} 

Se muestran dos tipos de sincrozicanciones que se realizan en el sistema: 
por socket, cuando el usario se conecta al servidor, sincorniza su reloj con 
este.
Cuando se conecta a un fogon, envia una oferta WebRTC para establecer un canal.
La aplicacion puede sincronizarse con un usuario particular a pedido del servidor
 o del usuario: el primero porque los supone en la misma 
red WiFi, el usuario desde la configuracion.
Vemos el intercambio de mensajes:

\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{out/diaguml/diagrama-secuencia-sincronizar/diagrama-secuencia-sincronizar}
\caption{Secuencia de sincronizacion de reloj}
\end{figure}

